"use strict";const e=require("../../common/vendor.js"),t=require("../../request/index.js"),a=require("../../stores/counter.js");if(!Array){(e.resolveComponent("van-sidebar-item")+e.resolveComponent("van-sidebar")+e.resolveComponent("van-card")+e.resolveComponent("van-empty")+e.resolveComponent("van-tab")+e.resolveComponent("van-button")+e.resolveComponent("van-tabs")+e.resolveComponent("van-overlay")+e.resolveComponent("van-loading"))()}const o={__name:"order",setup(o){const l=a.Store(),r=e.index.getStorageSync("sessionCookie");let n=["创建接单","暂无接单","派送中","已完成"],s=["暂无接单","派送中","已完成"];const u=e.ref(!1),d=()=>{u.value=!1};let i=null,c=null,v=null;const p=()=>{i?(m(i),i=null):(g(c,v),c=null,v=null)},m=async e=>{u.value=!1,await t.request({url:"userCart/update/state/by/CartIdAndUserId",method:"POST",header:{"content-type":"application/json",Cookie:r},data:{cartId:e,state:3}}).then((e=>{console.log(e),0===e.data.code&&(D.value=[],S=1,J=!0,F())}))},g=async(e,a)=>{console.log(e,a),u.value=!1,await t.request({url:"holdOrder/update/success",method:"POST",header:{"content-type":"application/json",Cookie:r},data:{id:e,submit_id:a}}).then((e=>{0===e.data.code&&(A.value=[],C=1,R=!0,K())}))};e.onLoad((()=>{j()}));let h=0;const y=e=>{h=e.detail.index,0==h?(w.value=0,N.value=[],q.value=[],O=1,b=1,_=!0,x=!0,j()):1==h&&(P.value=0,D.value=[],A.value=[],S=1,C=1,J=!0,R=!0,F())},f=e.ref(!1);e.onPullDownRefresh((()=>{_=!0,x=!0,J=!0,R=!0,N.value=[],O=1,j()}));let O=1,b=1,S=1,C=1;e.onReachBottom((async()=>{f.value=!0,await setTimeout((()=>{f.value=!1,0==h&&0==w.value?(console.log("发布外卖订单"),O++,j()):0==h&&1==w.value?(console.log("发布其他订单"),b++,z()):1==h&&0==P.value?(console.log("服务外卖订单"),S++,F()):1==h&&1==P.value&&(console.log("服务其他订单"),C++,K())}),800)}));const I=e.ref(!1);let _=!0;const T=e.ref(!0),w=e.ref(0),N=e.ref([]),j=async()=>{T.value||1!=w.value||(N.value=[],_=!0,O=1),T.value=!0,w.value=0,_&&await t.request({url:"userCart/my/list/page/vo",method:"POST",header:{"content-type":"application/json",Cookie:r},data:{cartId:0,current:O,id:0,isDelete:0,num:0,pageSize:10,schoolId:1,schoolStoreFeedId:0,sortField:"createTime",sortOrder:"ascend",state:4,sum_money:0,user_id:l.userId}}).then((e=>{0==e.data.data.length?(_=!1,console.log(e.data)):(console.log("发布外卖订单:",e.data.data),N.value.push(...e.data.data),I.value=!1),0==N.value.length&&(I.value=!0)}))};let x=!0;const q=e.ref([]),z=async()=>{T.value&&0==w.value&&(q.value=[],x=!0,b=1),T.value=!1,w.value=1,x&&await t.request({url:"submitOrder/my/list/page/vo",method:"POST",header:{"content-type":"application/json",Cookie:r},data:{current:b,id:"",isDelete:0,order_state:4,pageSize:10,schoolId:0,sortField:"",sortOrder:"",submit_index:0,userId:l.userId}}).then((e=>{0==e.data.data.records.length?(x=!1,console.log(e.data)):(q.value.push(...e.data.data.records),console.log("发布其他订单",e.data.data.records),I.value=!1),0==q.value.length&&(I.value=!0)}))};let J=!0;const k=e.ref(!0),P=e.ref(0),D=e.ref([]),F=async()=>{k.value||1!=P.value||(D.value=[],J=!0,S=1),k.value=!0,P.value=0,J&&await t.request({url:"feedOrderCenter/my/holdOrder/list",method:"POST",data:{current:S,pageSize:10,id:0,mpOpenId:"",sortField:"",sortOrder:"",unionId:"",userMoney:0,userName:"",userProfile:"",userRole:""},header:{"content-type":"application/json",Cookie:r}}).then((e=>{console.log(e),null==e.data.data?(J=!1,console.log(e.data)):(D.value.push(...e.data.data),I.value=!1),0==D.value.length&&(I.value=!0),console.log("服务外卖订单",D.value)}))};let R=!0;const A=e.ref([]),K=async()=>{k.value&&0==P.value&&(A.value=[],R=!0,C=1),k.value=!1,P.value=1,R&&await t.request({url:"holdOrder/my/hold/list",method:"POST",header:{"content-type":"application/json",Cookie:r},data:{current:C,pageSize:10}}).then((e=>{null==e.data.data?(R=!1,console.log(e.data)):(I.value=!1,A.value.push(...e.data.data),console.log("服务其他订单",A.value)),0==A.value.length&&(I.value=!0)}))},L=(t,a)=>{a<2&&e.index.navigateTo({url:`/subpages/publish/publish?content=${t}`})},M=e=>{let t=new Date(e);return(parseInt(t.getMonth())+1).toString()+"月"+t.getDate()+"日"+t.getHours()+"时"+t.getMinutes()+"分"};return(t,a)=>({a:e.o(j),b:e.p({title:"外卖订单",dot:!0}),c:e.o(z),d:e.p({title:"其他订单",dot:!0}),e:e.p({activeKey:w.value}),f:e.f(N.value,((t,a,o)=>({a:e.t(M(t.createTime)),b:e.t(M(t.deliveryTime)),c:"5837877e-5-"+o+",5837877e-1",d:e.p({price:t.sum_money,title:t.feeds.feed_name,thumb:t.feeds.url,tag:e.unref(n)[t.state],lazyLoad:!0}),e:a}))),g:I.value,h:e.p({description:"暂无订单"}),i:T.value,j:e.f(q.value,((t,a,o)=>({a:e.t(JSON.parse(t.content).explain.replace(/null/g,"")),b:e.t(M(JSON.parse(t.content).expectTime)),c:"5837877e-7-"+o+",5837877e-1",d:e.p({title:JSON.parse(t.content).className,price:JSON.parse(t.content).order_money}),e:e.t(e.unref(s)[t.order_state]),f:e.o((e=>L(t.content,t.order_state)),a),g:a}))),k:I.value,l:e.p({description:"暂无订单"}),m:!T.value,n:e.p({title:"发布订单"}),o:e.o(F),p:e.p({title:"外卖订单",dot:!0}),q:e.o(K),r:e.p({title:"其他订单",dot:!0}),s:e.p({activeKey:P.value}),t:e.f(D.value,((t,a,o)=>e.e({a:e.t(M(t.createTime)),b:e.t(M(t.deliveryTime)),c:"5837877e-13-"+o+",5837877e-9",d:e.p({title:t.storeName,thumb:t.schoolStoreFeeds.url,tag:e.unref(n)[t.state],lazyLoad:!0}),e:e.o((a=>((t,a)=>{console.log(a,t);let o=null;2==a&&(o={cartId:t,state:a}),e.index.navigateTo({url:`/subpages/pay/pay?orderDetail=${encodeURIComponent(JSON.stringify(o))}`})})(t.cartId,t.state)),a),f:3==t.state},3==t.state?{}:{g:e.o((e=>{return a=t.cartId,u.value=!0,void(i=a);var a}),a),h:"5837877e-14-"+o+",5837877e-9",i:e.p({type:"primary",size:"small"})},{j:a}))),v:I.value,w:e.p({description:"暂无订单"}),x:k.value,y:e.f(A.value,((t,a,o)=>e.e({a:e.t(JSON.parse(t.submitOrder.content).explain.replace(/null/g,"")),b:e.t(M(JSON.parse(t.submitOrder.content).expectTime)),c:"5837877e-16-"+o+",5837877e-9",d:e.p({title:JSON.parse(t.submitOrder.content).className,price:JSON.parse(t.submitOrder.content).order_money}),e:e.o((e=>L(t.submitOrder.content,t.submitOrder.order_state)),a),f:2==t.submitOrder.order_state},2==t.submitOrder.order_state?{}:{g:e.o((e=>{return a=t.id,o=t.submit_id,u.value=!0,c=a,void(v=o);var a,o}),a),h:"5837877e-17-"+o+",5837877e-9",i:e.p({type:"primary",size:"small"})},{j:a}))),z:I.value,A:e.p({description:"暂无订单"}),B:!k.value,C:e.p({title:"服务订单"}),D:e.o(y),E:e.p({animated:!0,swipeable:!0,sticky:!0}),F:e.o(p),G:e.p({type:"primary",size:"large",round:!0,color:"linear-gradient(to right, #ff2950, #f64a06)"}),H:e.o(d),I:e.p({show:u.value}),J:e.p({color:"#1989fa",type:"spinner"}),K:f.value})}};wx.createPage(o);
